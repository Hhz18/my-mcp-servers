# Agent 操作手册

## 1. 代码修改前置检查

修改代码前，必须先查看项目架构图和目录结构，充分理解上下文。

## 2. 架构模式底线

**底线原则**：不能破坏原有的架构模式。

## 3. Bug 修复原则

* **优先修改现有函数**：尽量避免创建新函数，除非现有逻辑无法满足需求。
* **按需创建**：只有在确实需要不同功能时才创建新函数。
* **保持简洁**：确保代码简洁、逻辑清晰且易于维护。

## 4. 代码重构原则

* **功能不变**：在不改变原有功能的前提下进行重构。
* **去重合并**：合并相似功能的函数，使用模板或泛型方法减少重复代码。
* **类型安全**：在确保类型安全的同时减少冗余函数。

## 5. 架构一致性原则

* **分层架构**：严格遵循项目现有的分层架构设计。
* **UI 与逻辑分离**：保持 UI 层与业务逻辑层的严格分离，**避免**在 UI 层直接实现业务逻辑。

## 6. 测试验证原则

* **功能验证**：修改后必须验证相关功能是否正常工作。
* **编译检查**：确保代码编译无错误。
* **流向确认**：确认数据流向（Data Flow）是否正确。

## 7. 主题系统开发原则

* **独立性**：主题系统作为工具模块，应独立于业务逻辑。
* **单例管理**：主题管理采用单例模式，便于全局统一管理。
* **动态切换**：UI 界面必须支持动态主题切换。
* **视觉一致**：保持所有界面元素的视觉风格一致性。

## 8. 模块化开发原则

如果系统架构为 **中心引擎/界面 + 多个子模块/子界面**：

* **职责归位**：当子模块出现问题时，必须在**子模块对应的文件**中修改代码，严禁将所有修复逻辑堆砌在主界面或中心引擎中。
* **引擎纯净**：必须保证中心引擎的代码保持**简洁、优雅、美观**。

## 9. 架构图生成规范

在构建项目或文档时，应自动生成包含以下四层的分层架构图（参考外卖系统架构）：

1. **表现层 (Presentation Layer)**: 主界面、登录页等。
2. **业务逻辑层 (Business Layer)**: 服务类 (Service)、管理类 (Manager)。
3. **数据模型层 (Data Model Layer)**: 实体 (Entity)、数据结构。
4. **数据管理层 (Data Access Layer)**: 持久化、JSON/数据库存取。

### 示例图

```ascii
┌─────────────────────────────────────────────────────────────┐
│                    表现层 (Presentation Layer)              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   MainWindow    │  │  LoginWindow    │  │ AdminWindow  │ │
│  │   (主界面)      │  │  (登录界面)     │  │ (管理界面)   │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└───────────────────────────────┬─────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   业务逻辑层 (Business Layer)               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │  CartService    │  │ OrderService    │  │ DataManager  │ │
│  │  (购物车服务)   │  │  (订单服务)     │  │ (数据管理)   │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└───────────────────────────────┬─────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   数据模型层 (Data Model Layer)             │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌──────────────┐  │
│  │  User   │  │  Food   │  │  Shop   │  │   Order      │  │
│  │ (用户)  │  │ (菜品)  │  │ (商家)  │  │  (订单)      │  │
│  └─────────┘  └─────────┘  └─────────┘  └──────────────┘  │
│  ┌─────────┐                                                │
│  │ Review  │                                                │
│  │ (评价)  │                                                │
│  └─────────┘                                                │
└───────────────────────────────┬─────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                  数据管理层 (Data Access Layer)             │
│                    (文件持久化/JSON)                        │
└─────────────────────────────────────────────────────────────┘
```

## 10. 文档与图表绘制规范 (Documentation & Diagramming)

* **PlantUML 兼容性**: 在绘制 PUML 图表时，**禁止**使用 `!theme plain` 等可能导致旧版本插件解析失败的指令。推荐使用 `skinparam backgroundColor white` 等通用配置来保持图表样式整洁且兼容。
* **语法规范与别名**: 当节点名称包含特殊字符（如路径分隔符 `/`、连字符 `-`）或保留字时，**必须**使用别名（alias）进行引用（例如 `folder "core/handle/" as CoreHandle`），以防止语法解析错误。
* **中文化策略**: 除非有特殊要求，图表中的展示文本（Title, Package Name, Note, Description）应默认翻译为中文，以提升可读性。代码标识符（Alias/ID）保持英文以维持逻辑准确性。
* **双视图策略**: 对于复杂模块，应同时提供 **架构结构图 (Component/Class Diagram)** 和 **业务流程图 (Sequence Diagram)**。前者展示静态结构与依赖，后者展示动态交互与数据流向。

## 11. 对话与协作习惯 (Collaboration Habits)

* **文件优先交付**: 当用户明确指定输出文件（如 `@[docs/...]`）时，Agent 应直接将详细内容（分析报告、代码、图表）写入该文件，而不仅仅是在对话中回复。
* **即时修正与反馈**: 遇到工具错误（如 PUML 预览失败）或用户反馈问题时，应立即分析根本原因（如语法兼容性），并提供针对性的修复方案，而不是由于不确定而反复试错。
* **结构化分析优先**: 在接手新项目或新模块时，必须先进行目录结构、核心配置文件和技术栈的分析，建立上下文认知后，再进行具体的功能描述或代码修改。

## 12.agent在操作git时，每次进行命令行都应该解释命令行作用

## 13.在回答用户的时候，用中文回答
